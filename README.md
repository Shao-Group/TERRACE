# Introduction

TERRACE is a circRNA assembler for paired-end RNA-seq data.

# Installation

TERRACE uses an additional library of htslib. 
If it has not been installed in your system, you first
need to download and install them. You might also need to
export the runtime library path to certain environmental
variable (for example, `LD_LIBRARY_PATH`, for most linux distributions).
After installing this dependency, you then compile the source code of TERRACE.
If the dependency is not installed to the default system 
directories (for example, `/usr/local`, for most linux distributions),
its corresponding installing paths should be specified to `configure` of TERRACE.

## Install htslib
If htslib has not been installed, download htslib 
[(license)](https://github.com/samtools/htslib/blob/develop/LICENSE)
from (http://www.htslib.org/) with version 1.5 or higher.
Note that htslib relies on zlib. So if zlib has not been installed in your system,
you need to install zlib first. To do so, download zlib
[(license)](https://zlib.net/zlib_license.html) at (https://zlib.net/).
Use the following commands to install zlib:
```
./configure
make
make install
```
After installing zlib, use the following commands to build htslib:
```
./configure --disable-bz2 --disable-lzma --disable-gcs --disable-s3 --enable-libcurl=no
make
make install
```
The default installation location of htslib is `/usr/lib`.
If you would install it to a different location, replace the above `configure` line with
the following (by adding `--prefix=/path/to/your/htslib` to the end):
```
./configure --disable-bz2 --disable-lzma --disable-gcs --disable-s3 --enable-libcurl=no --prefix=/path/to/your/htslib
```
In this case, you also need to export the runtime library path (note that there
is an additional `lib` following the installation path):
```
export LD_LIBRARY_PATH=/path/to/your/htslib/lib:$LD_LIBRARY_PATH
```

## Build TERRACE

Use the following to compile TERRACE:
```
./configure --with-htslib=/path/to/your/htslib
make
```

If some of the dependencies are installed in the default system directory (for example, `/usr/lib`),
then the corresponding `--with-` option might not be necessary.
The executable file `terrace` will appear at `src/terrace`.

# Usage

The usage of `TERRACE` is:
```
terrace -i <input.bam> -o <output.gtf> -fa <reference-genome.fa> --read_length <length-of-paired-end-reads> -r [reference_annotation.gtf] -fe [feature_file] [options]
```

The `input.bam` is the read alignment file generated by some RNA-seq aligner, (for example, STAR or HISAT2).
Make sure that it is sorted; otherwise run `samtools` to sort it:
```
samtools sort input.bam > input.sort.bam
```
The reconstructed circular transcripts shall be written as GTF format into `output.gtf`. Detailed documentation about [GTF format](https://useast.ensembl.org/info/website/upload/gff.html) is available from Ensembl.

`reference-genome.fa` is the reference genome file in fasta format. Recommended - Gencode GRCh37/GRCh38.

`length-of-paired-end-reads` is the length of the reads used to produce the alignment file.

`reference_annotation.gtf` is the annotation file in GTF format. This parameter is optional.

`feature_file` is an optional csv file generated by TERRACE that contains circRNA features used in a machine learning model for assigning confidence scores. 


TERRACE support the following parameters. Please refer
to additional explanations below the table.

 Parameters | Default Value | Description
 ------------------------- | ------------- | ----------
 --help  | | print usage of TERRACE and exit
 --version | | print version of TERRACE and exit
 --preview | | show the inferred `library_type` and exit
 --library_type               | empty | chosen from {empty, unstranded, first, second}

`--library_type` is highly recommended to provide. The `unstranded`, `first`, and `second`
correspond to `fr-unstranded`, `fr-firststrand`, and `fr-secondstrand` used in standard Illumina
sequencing libraries. If none of them is given, i.e., it is `empty` by default, then TERRACE
will try to infer the `library_type` by itself (see `--preview`). Notice that such inference is based
on the `XS` tag stored in the input `bam` file. If the input `bam` file do not contain `XS` tag,
then it is essential to provide the `library_type` to TERRACE. You can try `--preview` to see
the inferred `library_type`.
